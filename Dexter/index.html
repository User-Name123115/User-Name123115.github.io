<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dexter</title>
<style>
  html, body {
    margin: 0; padding: 0; height: 100%; background: #121212; color: #eee; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden;
  }
  #particles-js {
    position: fixed; width: 100%; height: 100%; z-index: 0; top: 0; left: 0; background: #121212; filter: grayscale(90%);
  }
  header {
    position: fixed; width: 100%; z-index: 10; background: #1e1e1e; color: #eee; padding: 1rem; font-size: 1.5rem; font-weight: 600;
    text-align: center; user-select: none; border-bottom: 1px solid #333; box-sizing: border-box;
    text-shadow: 0 1px 3px rgba(0,0,0,0.7);
  }
  main {
    position: fixed; top: 56px; bottom: 0; width: 100%; overflow-y: auto; z-index: 5; padding: 1rem 0; box-sizing: border-box;
    display: flex; flex-direction: column; align-items: center;
  }
  .season {
    width: 90%; max-width: 700px; margin: 0.5rem 0;
    background: #222;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.6);
    overflow: hidden;
    user-select: none;
  }
  .season-header {
    cursor: pointer;
    padding: 0.6rem 1rem;
    font-weight: 600;
    font-size: 1.1rem;
    color: #ddd;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(90deg, #2a2a2a, #1f1f1f);
    transition: background-color 0.3s ease;
  }
  .season-header:hover {
    background: linear-gradient(90deg, #3a3a3a, #292929);
    color: #fff;
  }
  .arrow {
    width: 0;
    height: 0;
    border-top: 6px solid transparent;
    border-bottom: 6px solid transparent;
    border-left: 8px solid #bbb;
    transition: transform 0.3s ease, border-left-color 0.3s ease;
  }
  .arrow.open {
    transform: rotate(90deg);
    border-left-color: #fff;
  }
  .episodes {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    background: #181818;
  }
  .episodes.open {
    max-height: 1000px;
  }
  .episode-item {
    border-top: 1px solid #333;
  }
  .episode-link {
    display: block;
    padding: 0.45rem 1.2rem;
    color: #ccc;
    text-decoration: none;
    font-size: 0.95rem;
    transition: background-color 0.25s ease, color 0.25s ease;
  }
  .episode-link:hover {
    background-color: #333;
    color: #fff;
  }
  .error-message {
    max-width: 700px;
    margin: 2rem auto;
    font-size: 1.15rem;
    color: #f66;
    text-align: center;
    font-weight: 600;
  }
  footer {
    position: fixed; bottom: 0; width: 100%; color: #888; padding: 0.5rem; font-size: 0.9rem; background: #121212;
    text-align: center; border-top: 1px solid #222; box-sizing: border-box; z-index: 10;
    font-style: italic;
  }
  main::-webkit-scrollbar {
    width: 8px;
  }
  main::-webkit-scrollbar-track {
    background: #121212;
  }
  main::-webkit-scrollbar-thumb {
    background-color: #444;
    border-radius: 4px;
  }

  /* Player styles */
  #playerOverlay {
    position: fixed;
    top: 56px;
    left: 0;
    width: 100%;
    height: calc(100% - 56px);
    background: rgba(0, 0, 0, 0.95);
    z-index: 20;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    box-sizing: border-box;
  }
  #playerOverlay.active {
    display: flex;
  }
  #playerTitle {
    color: #eee;
    font-size: 1.5rem;
    margin-bottom: 1rem;
    text-align: center;
    max-width: 90vw;
    word-wrap: break-word;
  }
  #playerContainer {
    width: 90vw;
    max-width: 960px;
    height: 80vh;
    max-height: 540px;
    background: #000;
    box-shadow: 0 0 20px rgba(0,0,0,0.9);
    position: relative;
  }
  #playerContainer iframe {
    width: 100%;
    height: 100%;
    border: none;
  }
  #playerCloseBtn {
    position: absolute;
    top: 8px;
    right: 12px;
    background: transparent;
    border: none;
    font-size: 2rem;
    color: #eee;
    cursor: pointer;
    user-select: none;
    z-index: 30;
  }
  #playerCloseBtn:hover {
    color: #f44336;
  }
</style>
</head>
<body>
<div id="particles-js"></div>
<header>Dexter</header>
<main id="mainContent">
  Loading...
</main>
<footer>updated from a JSON file so i can add more if i need</footer>

<!-- Player overlay -->
<div id="playerOverlay" role="dialog" aria-modal="true" aria-labelledby="playerTitle">
  <button id="playerCloseBtn" aria-label="Close player">&times;</button>
  <h2 id="playerTitle"></h2>
  <div id="playerContainer"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script>
  particlesJS('particles-js', {
    particles: {
      number: { value: 80, density: { enable: true, value_area: 800 } },
      color: { value: '#ffffff' },
      shape: { type: 'circle' },
      opacity: { value: 0.15, random: false },
      size: { value: 3, random: true },
      line_linked: { enable: true, distance: 150, color: '#ffffff', opacity: 0.08, width: 1 },
      move: { enable: true, speed: 2, direction: 'none', random: true, straight: false, out_mode: 'out', bounce: false }
    },
    interactivity: {
      detect_on: 'canvas',
      events: {
        onhover: { enable: true, mode: 'grab' },
        onclick: { enable: true, mode: 'push' },
        resize: true
      },
      modes: {
        grab: { distance: 140, line_linked: { opacity: 0.3 } },
        push: { particles_nb: 4 }
      }
    },
    retina_detect: true
  });

  const mainContent = document.getElementById('mainContent');
  const playerOverlay = document.getElementById('playerOverlay');
  const playerTitle = document.getElementById('playerTitle');
  const playerContainer = document.getElementById('playerContainer');
  const playerCloseBtn = document.getElementById('playerCloseBtn');

  function encodeParam(param) {
    return encodeURIComponent(param);
  }

  function createSeasonElement(seasonName, episodes) {
    const container = document.createElement('section');
    container.classList.add('season');

    const header = document.createElement('div');
    header.className = 'season-header';
    header.textContent = seasonName;

    const arrow = document.createElement('span');
    arrow.className = 'arrow';
    header.appendChild(arrow);

    const episodesContainer = document.createElement('div');
    episodesContainer.className = 'episodes';

    for (const [episodeName, videoLink] of Object.entries(episodes)) {
      const epDiv = document.createElement('div');
      epDiv.className = 'episode-item';

      const epLink = document.createElement('a');
      epLink.href = '#';
      epLink.textContent = episodeName;
      epLink.className = 'episode-link';
      epLink.setAttribute('tabindex', '0');

      epLink.addEventListener('click', e => {
        e.preventDefault();
        openPlayer(videoLink, `${seasonName} - ${episodeName}`);
      });
      epLink.addEventListener('keypress', e => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          openPlayer(videoLink, `${seasonName} - ${episodeName}`);
        }
      });

      epDiv.appendChild(epLink);
      episodesContainer.appendChild(epDiv);
    }

    header.addEventListener('click', () => {
      const isOpen = episodesContainer.classList.toggle('open');
      arrow.classList.toggle('open', isOpen);
    });

    container.appendChild(header);
    container.appendChild(episodesContainer);
    return container;
  }

  // Extract Google Drive file ID from preview or share URL
  function extractFileId(driveUrl) {
    const match = driveUrl.match(/\/d\/([a-zA-Z0-9_-]+)/);
    return match ? match[1] : null;
  }

  function openPlayer(videoUrl, episodeTitle) {
    const fileId = extractFileId(videoUrl);
    if (!fileId) {
      alert('Invalid video URL.');
      return;
    }
    playerTitle.textContent = episodeTitle;
    playerContainer.innerHTML = '';
    const iframe = document.createElement('iframe');
    iframe.src = `https://drive.google.com/file/d/${fileId}/preview`;
    iframe.allow = "autoplay; encrypted-media";
    iframe.allowFullscreen = true;
    playerContainer.appendChild(iframe);
    playerOverlay.classList.add('active');
    // Prevent body scroll while player is open
    document.body.style.overflow = 'hidden';
  }

  function closePlayer() {
    playerOverlay.classList.remove('active');
    playerContainer.innerHTML = '';
    playerTitle.textContent = '';
    document.body.style.overflow = '';
  }

  playerCloseBtn.addEventListener('click', closePlayer);

  playerOverlay.addEventListener('click', e => {
    if (e.target === playerOverlay) {
      closePlayer();
    }
  });

  // Load JSON and build UI
  async function loadShows() {
    const url = 'https://raw.githubusercontent.com/User-Name123115/User-Name123115.github.io/main/Dexter/Updatelist.json';
    mainContent.textContent = 'Loading...';
    try {
      const response = await fetch(url);
      if (!response.ok) throw new Error(`HTTP error: ${response.status}`);

      const data = await response.json();

      mainContent.innerHTML = '';

      const isNested = Object.values(data).every(value => typeof value === 'object' && value !== null);

      if (!isNested) {
        mainContent.innerHTML = '<div class="error-message">Error: JSON structure must contain seasons with episodes. No seasons found.</div>';
        return;
      }

      for (const [season, episodes] of Object.entries(data)) {
        if (typeof episodes === 'object' && episodes !== null) {
          const seasonEl = createSeasonElement(season, episodes);
          mainContent.appendChild(seasonEl);
        }
      }
    } catch (err) {
      mainContent.innerHTML = '<div class="error-message">Error loading shows: ' + err.message + '</div>';
    }
  }

  loadShows();
</script>
</body>
</html>
